{% schema %}
{
  "name": "See It Button",
  "target": "section",
  "stylesheet": "see-it-modal.css",
  "javascript": "see-it-modal.js",
  "settings": [
    {
      "type": "text",
      "id": "button_label",
      "label": "Button Label",
      "default": "See it in your room"
    }
  ]
}
{% endschema %}

<div class="see-it-button-container" style="margin: 20px 0;">
  <button id="see-it-trigger" class="button see-it-btn" data-product-id="{{ product.id }}" data-product-image="{{ product.featured_image | image_url: width: 800 }}">
    {{ block.settings.button_label }}
  </button>
</div>

<div id="see-it-modal" class="see-it-modal hidden">
  <div class="see-it-modal-content">
    <span class="see-it-close">&times;</span>
    <h2>See it in your room</h2>
    
    <div id="see-it-step-1" class="see-it-step">
      <p>Upload a photo of your room</p>
      <input type="file" id="see-it-upload" accept="image/*" />
    </div>

    <div id="see-it-step-2" class="see-it-step hidden">
      <div id="see-it-canvas-container" style="position: relative; width: 100%; max-width: 500px; margin: 0 auto;">
        <img id="see-it-room-image" src="" alt="Room" width="500" height="500" style="width: 100%; display: block;" />
        <img id="see-it-product-image" src="" alt="Product" width="100" height="100" class="draggable" style="position: absolute; top: 50%; left: 50%; width: 100px; cursor: move; transform: translate(-50%, -50%);" />
      </div>
      <div style="margin-top: 15px; text-align: center;">
        <label for="see-it-scale-slider" style="display: block; margin-bottom: 5px; font-weight: bold;">Product Size: <span id="see-it-scale-value">1.0</span>x</label>
        <input type="range" id="see-it-scale-slider" min="0.5" max="2.0" step="0.1" value="1.0" style="width: 80%; max-width: 300px;" />
      </div>
      <div style="margin-top: 15px; text-align: center;">
        <label for="see-it-style-preset" style="display: block; margin-bottom: 5px; font-weight: bold;">Style:</label>
        <select id="see-it-style-preset" style="padding: 5px; border-radius: 4px; border: 1px solid #ccc;">
          <option value="neutral">Neutral</option>
          <option value="warm">Warm</option>
          <option value="crisp">Crisp</option>
        </select>
      </div>
      <div style="margin-top: 15px; text-align: center;">
        <button id="see-it-save-room" style="padding: 8px 16px; background: #008060; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">Save This Room</button>
      </div>
      <div style="margin-top: 20px;">
        <h4 style="margin-bottom: 10px; font-weight: bold;">Saved Rooms</h4>
        <div id="see-it-saved-rooms-list"></div>
      </div>
      <div style="margin-top: 10px; text-align: center;">
        <input type="file" id="see-it-mask-upload" accept="image/*" style="display: none;" />
        <button id="see-it-clean-room" class="button" style="margin-right: 5px;">Remove Object</button>
        <button id="see-it-reset-room" class="button" style="margin-right: 5px;">Reset Room</button>
        <button id="see-it-generate" class="button">Generate View</button>
      </div>
    </div>

    <div id="see-it-step-3" class="see-it-step hidden">
      <p id="see-it-status">Generating...</p>
      <div id="see-it-error" class="see-it-error hidden"></div>
      <div id="see-it-result"></div>
      <div id="see-it-actions" class="hidden" style="margin-top: 15px; text-align: center;">
        <button id="see-it-adjust-placement" class="button" style="margin-right: 5px;">Adjust Placement</button>
        <button id="see-it-retry" class="button see-it-retry-btn hidden">Retry</button>
      </div>
    </div>
  </div>
</div>
